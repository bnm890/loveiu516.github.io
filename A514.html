<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>A514溫濕度</title>
    <link rel="icon" href="http://i.imgur.com/TUpTQag.png">
    <!-- jquery -->
    <script src="http://loveiu516.github.io/jquery.min.js"></script> 
    <!-- bootstrap -->
    <link href="http://loveiu516.github.io/bootstrap.min.css" rel="stylesheet">
    <!-- react -->
    <script src="http://loveiu516.github.io/react.min.js"></script>
    <script src="http://loveiu516.github.io/react-dom.min.js"></script>
    <!-- babel -->
    <script src="http://loveiu516.github.io/browser.min.js"></script>
    <!-- react-bootstrap -->
    <script src="http://loveiu516.github.io/react-bootstrap.min.js"></script>
    <!-- googel chart -->
    <script src="http://loveiu516.github.io/loader.js"></script>
    
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    
  </head>
  <body style="background-color:#00FFCC;">
    <div id = "main"></div>
    
    <script type="text/babel">
    var Grid=ReactBootstrap.Grid;
    var Row=ReactBootstrap.Row;
    var Col=ReactBootstrap.Col;
    var ButtonsInstance = ReactBootstrap.ButtonsInstance;
    var ButtonToolbar = ReactBootstrap.ButtonToolbar;
    var ButtonInput = ReactBootstrap.ButtonInput;
    var Button = ReactBootstrap.Button;
    var Label = ReactBootstrap.Label;
    var Input = ReactBootstrap.Input;
    var Tabs = ReactBootstrap.Tabs;
    var Tab = ReactBootstrap.Tab;
    var Image = ReactBootstrap.Image;
    var Glyphicon=ReactBootstrap.Glyphicon;
    var Jumbotron=ReactBootstrap.Jumbotron;
    var Pager=ReactBootstrap.Pager;
    var Panel=ReactBootstrap.Panel;
    var ListGroupItem=ReactBootstrap.ListGroupItem;
    
    var tt="";
    var hh="";
    var ww="";
    
    var SetIntervalMixin = {
      componentWillMount: function() {
        this.intervals = [];
      },
      setInterval: function() {
        this.intervals.push(setInterval.apply(null, arguments));
      },
      componentWillUnmount: function() {
        this.intervals.forEach(clearInterval);
      }
    };
    
    var ButtonInput = React.createClass({
      
    mixins: [SetIntervalMixin], // Use the mixin
    getInitialState: function() {
      return {seconds: 0};
    },

    componentDidMount: function() {
    google.charts.load('current', {'packages': ['gauge']});
    this.get();
    this.setInterval(this.get, 5000); // Call a method on the mixin
    },

    get(){
      var getURL = "https://script.google.com/macros/s/AKfycbw-rRnX-mOW9psqn8g0rD74FgoSExeeBYqCZp9kx9tTskYBJ4k/exec";
        $.ajax({
        url: getURL,
        global: false,
        type: 'GET',
        dataType: 'json',
        async: true,
          success: function(json) {
            tt = json.tt;
            hh = json.hh;
            ww = json.ww;
            
            console.log(tt);
            console.log(hh);
            console.log(ww);
            
      google.charts.setOnLoadCallback(drawChart);
      function drawChart() {
        
        var datatt = google.visualization.arrayToDataTable(JSON.parse('[["Label","Value"],["溫度",' + tt + ']]'));
        var datahh = google.visualization.arrayToDataTable(JSON.parse('[["Label","Value"],["濕度",' + hh + ']]'));
        var dataww = google.visualization.arrayToDataTable(JSON.parse('[["Label","Value"],["水位",' + ww + ']]'));

        var optionstt = {
          width: 280,
          height: 280,
          redFrom: 30,
          redTo: 40,
          yellowFrom: 10,
          yellowTo: 20,
          minorTicks: 10,
          min:10,
          max:40
        };

        var optionshh = {
          width: 280,
          height: 280,
          redFrom: 80,
          redTo: 100,
          minorTicks: 10,
          min:40,
          max:100
        };

        var optionsww = {
          width: 280,
          height: 280,
          greenFrom: 440,
          greenTo:390,
          minorTicks: 10,
          min:600,
          max:350
        };

        var charttt = new google.visualization.Gauge(document.getElementById('tt_chart'));
        charttt.draw(datatt, optionstt);

        var charthh = new google.visualization.Gauge(document.getElementById('hh_chart'));
        charthh.draw(datahh, optionshh);

        var chartww = new google.visualization.Gauge(document.getElementById('ww_chart'));
        chartww.draw(dataww, optionsww);
        }
        
        ReactDOM.render(<h1><Label bsStyle="danger">目前溫度: {tt} °C</Label></h1>,document.getElementById('tt_show'));
        ReactDOM.render(<h1><Label bsStyle="danger">目前濕度: {hh} %</Label></h1>,document.getElementById('hh_show'));
        ReactDOM.render(<h1><Label bsStyle="danger">目前水位: {ww} </Label></h1>,document.getElementById('ww_show'));
        }
      });
    },

      render() {
        return (
        <Grid>
        <Row className="well">
             <Pager>
             <Panel header=<h0>A514溫濕度+水位</h0> bsStyle="info">
              <Col xs={12} md={4}>
                
              <center>
              <div id="tt_chart"></div>
              <div id="tt_show"></div>
              </center>
              
              </Col>
              <Col xs={12} md={4}>

              <center>
              <div id="hh_chart"></div>
              <div id="hh_show"></div>
              </center>

              </Col>
              <Col xs={12} md={4}>

              <center>
              <div id="ww_chart"></div>
              <div id="ww_show"></div>
              </center>

              </Col>

             </Panel>
             </Pager>
          </Row>
        </Grid>
        );
      }
    });
    ReactDOM.render(<ButtonInput />, main);
    </script>
  </body>
</html>
